

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Data filtering &mdash; PyMassSpec 2.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> PyMassSpec
          

          
            
            <img src="../_static/pyms.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="chapter01.html">1. Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pyms/documentation.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms/Baseline/Baseline.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyms.Baseline</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms/Deconvolution/Deconvolution.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyms.Deconvolution</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms/Display/Display.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyms.Display</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms/Experiment/Experiment.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyms.Experiment</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms/Gapfill/Gapfill.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyms.Gapfill</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms/GCMS/GCMS.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyms.GCMS</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms/Noise/Noise.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyms.Noise</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms/Peak/Peak.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyms.Peak</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms/Simulator/Simulator.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyms.Simulator</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms/Utils/Utils.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyms.Utils</span></code></a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing to PyMS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Contributing/Contributing.html">1. Contributing to PyMassSpec</a></li>
<li class="toctree-l1"><a class="reference internal" href="Contributing/StyleGuide.html">2. PyMassSpec coding Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Contributing/Source.html">3. Downloading PyMS source code</a></li>
<li class="toctree-l1"><a class="reference internal" href="Contributing/Building.html">4. Building from Source</a></li>
</ul>
<p class="caption"><span class="caption-text">Tests and Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/20a/20a.html">20a</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/20b/20b.html">20b</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/20c/20c.html">20c</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/20d/20d.html">20d</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/30a/30a.html">30a</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/30b/30b.html">30a</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/30c/30c.html">30c</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/31/31.html">31</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/32/32.html">32</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/40a/40a.html">40a</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/40b/40b.html">40b</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/41a/41a.html">41a</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/41b/41b.html">41b</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/42a/42a.html">42a</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/42b/42b.html">42b</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/43/43.html">43</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/50/50.html">50</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/51/51.html">51</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/52/52.html">52</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/53/53.html">53</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/54/54.html">54</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/60/60.html">60</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/61a/61a.html">61a</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/61b/61b.html">61b</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/62/62.html">62</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/63/63.html">63</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/64/64.html">64</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/70a/70a.html">70a</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/70b/70b.html">70b</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/71/71.html">71</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/90/90.html">90</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/91/91.html">91</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/92/92.html">92</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/93/93.html">93</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/94/94.html">94</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/95/95.html">95</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/A1/A1.html">A1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/A2/A2.html">A2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyms-test/x10/x10.html">x10</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PyMassSpec</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Data filtering</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/domdfcoding/pyms/docs/UserGuide/chapter05.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="data-filtering">
<h1><a class="toc-backref" href="#id7">Data filtering</a><a class="headerlink" href="#data-filtering" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#data-filtering" id="id7">Data filtering</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction" id="id8">Introduction</a></p></li>
<li><p><a class="reference internal" href="#time-strings" id="id9">Time strings</a></p></li>
<li><p><a class="reference internal" href="#intensity-matrix-resizing" id="id10">Intensity Matrix resizing</a></p>
<ul>
<li><p><a class="reference internal" href="#retention-time-range" id="id11">Retention time range</a></p></li>
<li><p><a class="reference internal" href="#mass-spectrum-range-and-entries" id="id12">Mass spectrum range and entries</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#noise-smoothing" id="id13">Noise smoothing</a></p>
<ul>
<li><p><a class="reference internal" href="#window-averaging" id="id14">Window averaging</a></p></li>
<li><p><a class="reference internal" href="#window-averaging-on-intensity-matrix" id="id15">Window Averaging on Intensity Matrix</a></p></li>
<li><p><a class="reference internal" href="#savitzky-golay-noise-filter" id="id16">Savitzky–Golay noise filter</a></p></li>
<li><p><a class="reference internal" href="#savitzky-golay-noise-filtering-of-intensity-matrix-object" id="id17">Savitzky-Golay Noise filtering of Intensity Matrix Object</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#baseline-correction" id="id18">Baseline correction</a></p>
<ul>
<li><p><a class="reference internal" href="#tophat-baseline-correction-on-an-intensity-matrix-object" id="id19">Tophat Baseline correction on an Intensity Matrix object</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#pre-processing-the-intensitymatrix" id="id20">Pre-processing the IntensityMatrix</a></p></li>
<li><p><a class="reference internal" href="#references" id="id21">References</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id8">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In this chapter filtering techniques that allow pre-processing of
GC-MS data for analysis and comparison to other pre-processed GC-MS data are
covered.</p>
</div>
<div class="section" id="time-strings">
<h2><a class="toc-backref" href="#id9">Time strings</a><a class="headerlink" href="#time-strings" title="Permalink to this headline">¶</a></h2>
<p>Before considering the filtering techniques, the mechanism for representing
retention times is outlined here.</p>
<p>A time string is the specification of a time interval, that takes the format
<code class="docutils literal notranslate"><span class="pre">NUMBERs</span></code> or <code class="docutils literal notranslate"><span class="pre">NUMBERm</span></code> for time interval in seconds or minutes. For
example, these are valid time strings: <code class="docutils literal notranslate"><span class="pre">10s</span></code> (10 seconds) and <code class="docutils literal notranslate"><span class="pre">0.2m</span></code>
(0.2 minutes).</p>
</div>
<div class="section" id="intensity-matrix-resizing">
<h2><a class="toc-backref" href="#id10">Intensity Matrix resizing</a><a class="headerlink" href="#intensity-matrix-resizing" title="Permalink to this headline">¶</a></h2>
<p>Once an IntensityMatrix has been constructed from the raw GC-MS data, the
entries of the matrix can be modified. These modifications can operate on the
entire matrix, or individual masses or scans.</p>
<div class="section" id="retention-time-range">
<h3><a class="toc-backref" href="#id11">Retention time range</a><a class="headerlink" href="#retention-time-range" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example is in <a class="reference external" href="../pyms-test/40a/40a.html">pyms-test/40a</a></p>
</div>
<p>A basic operation on the GC-MS data is to select a specific time range for
processing. In PyMS, any data outside the chosen time range is discarded. The
<a class="reference internal" href="../pyms/GCMS/GCMS.html#pyms.GCMS.Class.GCMS_data.trim" title="pyms.GCMS.Class.GCMS_data.trim"><code class="xref py py-meth docutils literal notranslate"><span class="pre">trim()</span></code></a>
method operates on the raw data, so any subsequent processing only
refers to the trimmed data.</p>
<p>Given a previously loaded raw GC-MS data file, <code class="docutils literal notranslate"><span class="pre">data</span></code>, the data can be
trimmed to specific scans;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
</div>
<p>or specific retention times (in <code class="docutils literal notranslate"><span class="pre">seconds</span></code> or <code class="docutils literal notranslate"><span class="pre">minutes</span></code>);</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="s2">&quot;6.5m&quot;</span><span class="p">,</span> <span class="s2">&quot;21m&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="mass-spectrum-range-and-entries">
<h3><a class="toc-backref" href="#id12">Mass spectrum range and entries</a><a class="headerlink" href="#mass-spectrum-range-and-entries" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example is in <a class="reference external" href="../pyms-test/40b/40b.html">pyms-test/40b</a></p>
</div>
<p>An IntensityMatrix object has a set mass range and interval that is derived
from the data at the time of building the intensity matrix. The range of mass
values can be cropped. This is done, primarily, to ensure that the range of
masses used are consistent when comparing samples.</p>
<p>Given a previously loaded raw GC-MS data file that has been converted into an
IntensityMatrix, <cite>im</cite>, the mass range can be “cropped” to a new (smaller)
range;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">crop_mass</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">get_min_mass</span><span class="p">(),</span> <span class="n">im</span><span class="o">.</span><span class="n">get_max_mass</span><span class="p">())</span>
</pre></div>
</div>
<p>It is also possible to set all intensities for a given mass to zero. This is
useful for ignoring masses associated with sample preparation. The mass can be
“nulled” via;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">null_mass</span><span class="p">(</span><span class="mi">73</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">get_ic_at_mass</span><span class="p">(</span><span class="mi">73</span><span class="p">)</span><span class="o">.</span><span class="n">get_intensity_array</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="noise-smoothing">
<h2><a class="toc-backref" href="#id13">Noise smoothing</a><a class="headerlink" href="#noise-smoothing" title="Permalink to this headline">¶</a></h2>
<p>The purpose of noise smoothing is to remove high-frequency noise from
data, and thereby increase the contribution of the signal relative to
the contribution of the noise.</p>
<div class="section" id="window-averaging">
<h3><a class="toc-backref" href="#id14">Window averaging</a><a class="headerlink" href="#window-averaging" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example is in <a class="reference external" href="../pyms-test/41a/41a.html">pyms-test/41a</a></p>
</div>
<p>A simple approach to noise smoothing is moving average window smoothing.
In this approach the window of a fixed size (<span class="math notranslate nohighlight">\(2N+1\)</span> points) is moved
across the ion chromatogram, and the intensity value at each point is
replaced with the mean intensity calculated over the window size.
The example below illustrates smoothing of TIC by window averaging.</p>
<p>Load the data and get the TIC:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">andi_file</span> <span class="o">=</span> <span class="s2">&quot;data/gc01_0812_066.cdf&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">ANDI_reader</span><span class="p">(</span><span class="n">andi_file</span><span class="p">)</span>
<span class="go"> -&gt; Reading netCDF file &#39;data/gc01_0812_066.cdf&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tic</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get_tic</span><span class="p">()</span>
</pre></div>
</div>
<p>Apply the mean window smoothing with the 5-point window:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyms.Noise.Window</span> <span class="kn">import</span> <span class="n">window_smooth</span>
<span class="n">tic1</span> <span class="o">=</span> <span class="n">window_smooth</span><span class="p">(</span><span class="n">tic</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
 <span class="o">-&gt;</span> <span class="n">Window</span> <span class="n">smoothing</span> <span class="p">(</span><span class="n">mean</span><span class="p">):</span> <span class="n">the</span> <span class="n">wing</span> <span class="ow">is</span> <span class="mi">2</span> <span class="n">point</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
<p>Apply the median window smoothing with the 5-point window:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tic2</span> <span class="o">=</span> <span class="n">window_smooth</span><span class="p">(</span><span class="n">tic</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">median</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go"> -&gt; Window smoothing (median): the wing is 2 point(s)</span>
</pre></div>
</div>
<p>Apply the mean windows smoothing, but specify the window as
a time string (in this example, 7 seconds):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tic3</span> <span class="o">=</span> <span class="n">window_smooth</span><span class="p">(</span><span class="n">tic</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s1">&#39;7s&#39;</span><span class="p">)</span>
<span class="go">-&gt; Window smoothing (mean): the wing is 9 point(s)</span>
</pre></div>
</div>
<p>Time strings are explained in the Section <a class="reference internal" href="#time-strings">Time Strings</a>.</p>
</div>
<div class="section" id="window-averaging-on-intensity-matrix">
<h3><a class="toc-backref" href="#id15">Window Averaging on Intensity Matrix</a><a class="headerlink" href="#window-averaging-on-intensity-matrix" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example is in <a class="reference external" href="../pyms-test/41b/41b.html">pyms-test/41b</a></p>
</div>
<p>In the previous section, window averaging was applied to an
Ion Chromatogram object (in that case a TIC). Where filtering
is to be performed on all Ion Chromatograms, the
<a class="reference internal" href="../pyms/Noise/Noise.html#pyms.Noise.Window.window_smooth_im" title="pyms.Noise.Window.window_smooth_im"><code class="xref py py-meth docutils literal notranslate"><span class="pre">window_smooth_im()</span></code></a>
function may be used instead.</p>
<p>The use of this function is identical to the Ion Chromatogram
<a class="reference internal" href="../pyms/Noise/Noise.html#pyms.Noise.Window.window_smooth" title="pyms.Noise.Window.window_smooth"><code class="xref py py-meth docutils literal notranslate"><span class="pre">window_smooth()</span></code></a>
function, except that an Intensity Matrix
is passed to it.</p>
<p>For example, to perform window smoothing on an
<a class="reference internal" href="../pyms/GCMS/GCMS.html#pyms.GCMS.Class.IntensityMatrix" title="pyms.GCMS.Class.IntensityMatrix"><code class="xref py py-meth docutils literal notranslate"><span class="pre">IntensityMatrix</span></code></a>
object with a 5 point window and mean window smoothing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyms.Noise.Window</span> <span class="k">import</span> <span class="n">window_smooth_im</span><span class="p">()</span>
<span class="gp">... </span><span class="n">im</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">PyMS</span> <span class="n">IntensityMatrix</span> <span class="nb">object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_smooth</span> <span class="o">=</span> <span class="n">window_smooth_im</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">window</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">median</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="savitzky-golay-noise-filter">
<h3><a class="toc-backref" href="#id16">Savitzky–Golay noise filter</a><a class="headerlink" href="#savitzky-golay-noise-filter" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example is in <a class="reference external" href="../pyms-test/41c/41c.html">pyms-test/41c</a></p>
</div>
<p>A more sophisticated noise filter is the Savitzky-Golay filter.
Given the data loaded as above, this filter can be applied as
follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyms.Noise.SavitzkyGolay</span> <span class="k">import</span> <span class="n">savitzky_golay</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tic1</span> <span class="o">=</span> <span class="n">savitzky_golay</span><span class="p">(</span><span class="n">tic</span><span class="p">)</span>
<span class="go"> -&gt; Applying Savitzky-Golay filter</span>
<span class="go">      Window width (points): 7</span>
<span class="go">      Polynomial degree: 2</span>
</pre></div>
</div>
<p>In this example the default parameters were used.</p>
</div>
<div class="section" id="savitzky-golay-noise-filtering-of-intensity-matrix-object">
<h3><a class="toc-backref" href="#id17">Savitzky-Golay Noise filtering of Intensity Matrix Object</a><a class="headerlink" href="#savitzky-golay-noise-filtering-of-intensity-matrix-object" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example is in <a class="reference external" href="../pyms-test/41d/41d.html">pyms-test/41d</a></p>
</div>
<p>The <a class="reference internal" href="../pyms/Noise/Noise.html#pyms.Noise.SavitzkyGolay.savitzky_golay" title="pyms.Noise.SavitzkyGolay.savitzky_golay"><code class="xref py py-meth docutils literal notranslate"><span class="pre">savitzky_golay()</span></code></a>
function described in the previous section acts on a single
Ion Chromatogram. Where it is desired to perform Savitzky Golay
filtering on the whole Intensity matrix the function
<a class="reference internal" href="../pyms/Noise/Noise.html#pyms.Noise.SavitzkyGolay.savitzky_golay_im" title="pyms.Noise.SavitzkyGolay.savitzky_golay_im"><code class="xref py py-meth docutils literal notranslate"><span class="pre">savitzky_golay_im()</span></code></a>
may be used as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyms.Noise.SavitzkyGolay</span> <span class="k">import</span> <span class="n">savitzky_golay_im</span>
<span class="gp">... </span><span class="n">im</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">PyMS</span> <span class="n">IntensityMatrix</span> <span class="nb">object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_smooth</span> <span class="o">=</span> <span class="n">savitzky_golay</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="baseline-correction">
<h2><a class="toc-backref" href="#id18">Baseline correction</a><a class="headerlink" href="#baseline-correction" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example is in <a class="reference external" href="../pyms-test/62a/62a.html">pyms-test/62a</a></p>
</div>
<p>Baseline distortion originating from instrument imperfections and
experimental setup is often observed in mass spectrometry data,
and off-line baseline correction is often an important step in
data pre-processing. There are many approaches for baseline
correction. One advanced approach is based top-hat transform
developed in mathematical morphology <a class="footnote-reference brackets" href="#id5" id="id1">1</a>, and used
extensively in digital image processing for tasks such as image
enhancement. Top-hat baseline correction was previously applied
in proteomics based mass spectrometry <a class="footnote-reference brackets" href="#id6" id="id2">2</a>.</p>
<p>PyMS currently implements only top-hat baseline corrector, using
the SciPy package <code class="docutils literal notranslate"><span class="pre">ndimage</span></code>.</p>
<p>Application of the top-hat baseline corrector requires the size
of the structural element to be specified. The structural element
needs to be larger than the features one wants to retain in the
spectrum after the top-hat transform. In the example below, the
top-hat baseline corrector is applied to the TIC of the data set
<code class="docutils literal notranslate"><span class="pre">gc01_0812_066.cdf</span></code>, with the structural element of 1.5 minutes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyms.GCMS.IO.ANDI.Function</span> <span class="k">import</span> <span class="n">ANDI_reader</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">andi_file</span> <span class="o">=</span> <span class="s2">&quot;data/gc01_0812_066.cdf&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">ANDI_reader</span><span class="p">(</span><span class="n">andi_file</span><span class="p">)</span>
<span class="go"> -&gt; Reading netCDF file &#39;data/gc01_0812_066.cdf&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tic</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get_tic</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyms.Noise.SavitzkyGolay</span> <span class="k">import</span> <span class="n">savitzky_golay</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tic1</span> <span class="o">=</span> <span class="n">savitzky_golay</span><span class="p">(</span><span class="n">tic</span><span class="p">)</span>
<span class="go"> -&gt; Applying Savitzky-Golay filter</span>
<span class="go">      Window width (points): 7</span>
<span class="go">      Polynomial degree: 2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyms.Baseline.TopHat</span> <span class="k">import</span> <span class="n">tophat</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tic2</span> <span class="o">=</span> <span class="n">tophat</span><span class="p">(</span><span class="n">tic1</span><span class="p">,</span> <span class="n">struct</span><span class="o">=</span><span class="s2">&quot;1.5m&quot;</span><span class="p">)</span>
<span class="go"> -&gt; Top-hat: structural element is 239 point(s)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tic</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;output/tic.dat&quot;</span><span class="p">,</span><span class="n">minutes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tic1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;output/tic_smooth.dat&quot;</span><span class="p">,</span><span class="n">minutes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tic2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;output/tic_smooth_bc.dat&quot;</span><span class="p">,</span><span class="n">minutes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>In the interactive session shown above, the data set if first loaded,
Savitzky-Golay smoothing was applied, followed by baseline correction.
Finally the original, smoothed, and smoothed and baseline corrected
TIC were saved in the directory <code class="docutils literal notranslate"><span class="pre">output/</span></code>.</p>
<div class="section" id="tophat-baseline-correction-on-an-intensity-matrix-object">
<h3><a class="toc-backref" href="#id19">Tophat Baseline correction on an Intensity Matrix object</a><a class="headerlink" href="#tophat-baseline-correction-on-an-intensity-matrix-object" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example is in <a class="reference external" href="../pyms-test/42b/42b.html">pyms-test/42b</a></p>
</div>
<p>The <a class="reference internal" href="../pyms/Baseline/Baseline.html#pyms.Baseline.TopHat.tophat" title="pyms.Baseline.TopHat.tophat"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tophat()</span></code></a> function
outlined in the instructions above, acts on a single
<a class="reference internal" href="../pyms/GCMS/GCMS.html#pyms.GCMS.Class.IonChromatogram" title="pyms.GCMS.Class.IonChromatogram"><code class="xref py py-meth docutils literal notranslate"><span class="pre">IonChromatogram</span></code></a>.
To perform baseline correction on an
<a class="reference internal" href="../pyms/GCMS/GCMS.html#pyms.GCMS.Class.IntensityMatrix" title="pyms.GCMS.Class.IntensityMatrix"><code class="xref py py-meth docutils literal notranslate"><span class="pre">IntensityMatrix</span></code></a>
object (i.e. on all <cite>Ion Chromatograms</cite>) the
<a class="reference internal" href="../pyms/Baseline/Baseline.html#pyms.Baseline.TopHat.tophat_im" title="pyms.Baseline.TopHat.tophat_im"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tophat_im()</span></code></a>
function may be used.</p>
<p>Using the same definition for “<cite>struct</cite>” as above, use of the
<a class="reference internal" href="../pyms/Baseline/Baseline.html#pyms.Baseline.TopHat.tophat_im" title="pyms.Baseline.TopHat.tophat_im"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tophat_im()</span></code></a>
function is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyms.Baseline.TopHat</span> <span class="k">import</span> <span class="n">tophat_im</span><span class="p">()</span>
<span class="gp">... </span><span class="n">im</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">Intensity</span> <span class="n">Matrix</span> <span class="nb">object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_base_corr</span> <span class="o">=</span> <span class="n">tophat</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">struct</span><span class="o">=</span><span class="s2">&quot;1.5m&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pre-processing-the-intensitymatrix">
<h2><a class="toc-backref" href="#id20">Pre-processing the IntensityMatrix</a><a class="headerlink" href="#pre-processing-the-intensitymatrix" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example is in <a class="reference external" href="../pyms-test/43/43.html">pyms-test/43</a></p>
</div>
<p>The entire noise smoothing and baseline correction can be applied to each ion
chromatogram in the intensity matrix;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">jcamp_file</span> <span class="o">=</span> <span class="s2">&quot;data/gc01_0812_066.jdx&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">JCAMP_reader</span><span class="p">(</span><span class="n">jcamp_file</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">build_intensity_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n_scan</span><span class="p">,</span> <span class="n">n_mz</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mz</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span> <span class="s2">&quot;Working on IC#&quot;</span><span class="p">,</span> <span class="n">ii</span><span class="o">+</span><span class="mi">1</span>
<span class="gp">... </span>    <span class="n">ic</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">get_ic_at_index</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">ic_smooth</span> <span class="o">=</span> <span class="n">savitzky_golay</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">ic_bc</span> <span class="o">=</span> <span class="n">tophat</span><span class="p">(</span><span class="n">ic_smooth</span><span class="p">,</span> <span class="n">struct</span><span class="o">=</span><span class="s2">&quot;1.5m&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">im</span><span class="o">.</span><span class="n">set_ic_at_index</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">ic_bc</span><span class="p">)</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>Alternatively, the filtering may be performed on the Intensity Matrix without
using a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop, as outlined in the sections above. However filtering by
Ion Chromatogram in a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop as described here is much faster.</p>
<p>The resulting IntensityMatrix object can be <a href="#id3"><span class="problematic" id="id4">``</span></a>dumped’’ to a file for later
retrieval. There are general perpose object file handling methods in
<a class="reference internal" href="../pyms/Utils/Utils.html#module-pyms.Utils.IO" title="pyms.Utils.IO"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyms.Utils.IO</span></code></a>. For example;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyms.Utils.IO</span> <span class="k">import</span> <span class="n">dump_object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dump_object</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="s2">&quot;output/im-proc.dump&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#id21">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id5"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Serra J. <cite>Image Analysis and Mathematical Morphology</cite>. Academic Press, Inc, Orlando, 1983. ISBN 0126372403</p>
</dd>
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>Sauve AC and Speed TP. Normalization, baseline correction and alignment of high-throughput mass spectrometry data. <cite>Procedings Gensips</cite>, 2004</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright PyMassSpec Developers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>